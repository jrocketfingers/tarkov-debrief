{"version":3,"sources":["maps/customs.png","maps/interchange.png","maps/woods.png","maps/labs.jpg","maps/reserve.png","maps/shoreline.png","maps/factory.jpg","maps/customs-thumbnail.png","maps/interchange-thumbnail.png","maps/woods-thumbnail.png","maps/labs-thumbnail.png","maps/reserve-thumbnail.png","maps/shoreline-thumbnail.png","maps/factory-thumbnail.png","MapSelector.tsx","App.tsx","icons/select.svg","icons/pencil.svg","icons/eraser.svg","icons/undo.svg","icons/marker.svg","icons/save.svg","icons/pmc-thick.svg","icons/pmc-med.svg","icons/pmc-light.svg","icons/scav.svg","reportWebVitals.ts","index.tsx"],"names":["maps","customs","interchange","woods","labs","reserve","shoreline","factory","thumbnails","customsThumbnail","interchangeThumbnail","woodsThumbnail","labsThumbnail","reserveThumbnail","shorelineThumbnail","factoryThumbnail","MapSelector","backgroundImage","className","to","Object","entries","map","key","src","alt","defaultSize","width","height","unerasable","Set","markerCache","PENCIL_COLOR","SidebarSection","title","children","App","useParams","containerRef","useRef","useState","type","active","onClick","cursor","tool","_setTool","toolRef","color","setColor","_setMarker","markerRef","canvas","setCanvas","sidebar","setSidebar","setTool","value","off","on","defaultCursor","hoverCursor","isDrawingMode","current","selectMarker","evt","target","placeMarker","a","cachedImage","Promise","resolve","fabric","Image","fromURL","newImage","clone","image","pointer","getPointer","e","left","x","top","y","zoom","getZoom","scale","add","useEffect","Canvas","perPixelTargetFind","selection","freeDrawingBrush","setCursor","pencilIcon","initializeCanvas","selectable","getSrc","clearHistory","opt","has","remove","event","delta","deltaY","zoomToPoint","offsetX","offsetY","preventDefault","stopPropagation","resizeListener","offsetWidth","offsetHeight","setDimensions","window","addEventListener","document","ctrlKey","undo","removeEventListener","selectIcon","eraserIcon","undoIcon","addMarkerIcon","url","name","link","createElement","download","href","body","appendChild","click","removeChild","startDownload","toDataURL","multiplier","saveIcon","id","thickPMCMarker","mediumPMCMarker","lightPMCMarker","scavMarker","triangle","onChangeComplete","hex","ref","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","path","getElementById"],"mappings":"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","file":"static/js/main.493c47fc.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/customs.e4219f37.png\";","export default __webpack_public_path__ + \"static/media/interchange.d1c1fd49.png\";","export default __webpack_public_path__ + \"static/media/woods.1db93aa7.png\";","export default __webpack_public_path__ + \"static/media/labs.bf97da17.jpg\";","export default __webpack_public_path__ + \"static/media/reserve.074ec021.png\";","export default __webpack_public_path__ + \"static/media/shoreline.23bac9da.png\";","export default __webpack_public_path__ + \"static/media/factory.87c85dcc.jpg\";","export default __webpack_public_path__ + \"static/media/customs-thumbnail.b02c6216.png\";","export default __webpack_public_path__ + \"static/media/interchange-thumbnail.20071bd5.png\";","export default __webpack_public_path__ + \"static/media/woods-thumbnail.70d05156.png\";","export default __webpack_public_path__ + \"static/media/labs-thumbnail.b903d684.png\";","export default __webpack_public_path__ + \"static/media/reserve-thumbnail.a98054b0.png\";","export default __webpack_public_path__ + \"static/media/shoreline-thumbnail.2a773a10.png\";","export default __webpack_public_path__ + \"static/media/factory-thumbnail.c6017793.png\";","import React from 'react';\r\nimport { Link } from 'react-router-dom';\r\n\r\nimport \"./MapSelector.css\";\r\n\r\nimport customs from \"./maps/customs.png\";\r\nimport interchange from \"./maps/interchange.png\";\r\nimport woods from \"./maps/woods.png\";\r\nimport labs from \"./maps/labs.jpg\";\r\nimport reserve from \"./maps/reserve.png\";\r\nimport shoreline from \"./maps/shoreline.png\";\r\nimport factory from \"./maps/factory.jpg\";\r\n\r\nimport customsThumbnail from \"./maps/customs-thumbnail.png\";\r\nimport interchangeThumbnail from \"./maps/interchange-thumbnail.png\";\r\nimport woodsThumbnail from \"./maps/woods-thumbnail.png\";\r\nimport labsThumbnail from \"./maps/labs-thumbnail.png\";\r\nimport reserveThumbnail from \"./maps/reserve-thumbnail.png\";\r\nimport shorelineThumbnail from \"./maps/shoreline-thumbnail.png\";\r\nimport factoryThumbnail from \"./maps/factory-thumbnail.png\";\r\n\r\nexport const maps: Record<string, string> = {customs, interchange, woods, labs, reserve, shoreline, factory};\r\nexport const thumbnails: Record<string, string> = {\r\n  customs: customsThumbnail,\r\n  interchange: interchangeThumbnail,\r\n  woods: woodsThumbnail,\r\n  labs: labsThumbnail,\r\n  reserve: reserveThumbnail,\r\n  shoreline: shorelineThumbnail,\r\n  factory: factoryThumbnail,\r\n};\r\n\r\nfunction MapSelector() {\r\n  return (\r\n    <div className=\"MapSelector\">\r\n      <header className=\"App-header\">\r\n        <Link className=\"App-header-title\" to=\"/\">Tarkov Debrief</Link>\r\n      </header>\r\n      <section className=\"MapList\">\r\n        {Object.entries(maps).map(([key, value]) => \r\n          <Link className=\"MapList-Card\" to={`/app/${key}`}>\r\n            <img src={thumbnails[key]} alt=\"key\"/>\r\n            <p>{key}</p>\r\n          </Link>\r\n        )}\r\n      </section>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default MapSelector;","import React, { useEffect, useRef, useState } from \"react\";\r\nimport { fabric } from \"fabric\";\r\nimport { ColorResult, TwitterPicker } from \"react-color\";\r\nimport \"fabric-history\";\r\nimport \"./App.css\";\r\nimport \"./Sidebar.css\";\r\n\r\nimport { maps } from \"./MapSelector\";\r\n\r\nimport selectIcon from \"./icons/select.svg\";\r\nimport pencilIcon from \"./icons/pencil.svg\";\r\nimport eraserIcon from \"./icons/eraser.svg\";\r\nimport undoIcon from \"./icons/undo.svg\";\r\nimport addMarkerIcon from \"./icons/marker.svg\";\r\nimport saveIcon from \"./icons/save.svg\";\r\n\r\nimport thickPMCMarker from \"./icons/pmc-thick.svg\";\r\nimport mediumPMCMarker from \"./icons/pmc-med.svg\";\r\nimport lightPMCMarker from \"./icons/pmc-light.svg\";\r\nimport scavMarker from \"./icons/scav.svg\";\r\nimport { IEvent } from \"fabric/fabric-impl\";\r\nimport { Link, useParams } from \"react-router-dom\";\r\n\r\ntype Size = { width: number; height: number };\r\n\r\nconst defaultSize: Size = { width: 300, height: 300 };\r\nlet backgroundImage: fabric.Image;\r\nlet unerasable = new Set<string>();\r\n\r\ntype Tool = {\r\n  active: boolean,\r\n  type: 'select' | 'pencil' | 'eraser' | 'marker',\r\n  onClick: null | ((evt: IEvent) => void),\r\n  cursor: null | string,\r\n};\r\n\r\nfunction startDownload(url: string, name: string) : void {\r\n  const link = document.createElement('a');\r\n  link.download = name;\r\n  link.href = url;\r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n}\r\n\r\nconst brushWidth = 5;\r\nconst markerCache: Record<string, fabric.Image> = {};\r\nconst PENCIL_COLOR: string = \"#f00\";\r\n\r\nfunction initializeCanvas() { \r\n  const canvas = new fabric.Canvas('canvas', {\r\n    height: defaultSize.height,\r\n    width: defaultSize.width,\r\n    //isDrawingMode: true,\r\n    perPixelTargetFind: true,\r\n    selection: false,\r\n  });\r\n\r\n  canvas.freeDrawingBrush.color = PENCIL_COLOR;\r\n  canvas.freeDrawingBrush.width = brushWidth;\r\n\r\n  canvas.setCursor(`url(${pencilIcon})`);\r\n\r\n  return canvas;\r\n}\r\n\r\ninterface SidebarSectionProps {\r\n  title: string,\r\n  children: React.ReactNode,\r\n}\r\n\r\nfunction SidebarSection({ title, children }: SidebarSectionProps) {\r\n  return <div className=\"sidebar-section\">\r\n    <h1 className=\"sidebar-section-title\">\r\n      {title}\r\n    </h1>\r\n    <div className=\"sidebar-section-content\">\r\n      {children}\r\n    </div>\r\n  </div>\r\n}\r\n\r\ninterface Params {\r\n  map: string;\r\n}\r\n\r\nfunction App() {\r\n  const { map } = useParams<Params>();\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const [tool, _setTool] = useState<Tool>({\r\n    type: 'pencil',\r\n    active: true,\r\n    onClick: null,\r\n    cursor: null,\r\n  });\r\n  const toolRef = useRef<Tool>({\r\n    type: 'pencil',\r\n    active: true,\r\n    onClick: null,\r\n    cursor: null,\r\n  });\r\n  const [color, setColor] = useState<string>(PENCIL_COLOR);\r\n  const [, _setMarker] = useState<string | null>(null);\r\n  const markerRef = useRef<string | null>(null);\r\n  const [canvas, setCanvas] = useState<fabric.Canvas | null>(null);\r\n  const [sidebar, setSidebar] = useState<boolean>(false);\r\n\r\n  /**\r\n   * Sets the current tool and resets canvas listeners.\r\n   * \r\n   * @param value: Tool\r\n   */\r\n  const setTool = (value: Tool) => {\r\n    // switch listeners (tool is old state, value is new)\r\n    if (canvas) {\r\n      if (tool.onClick) canvas.off('mouse:up', tool.onClick);\r\n      if (value.onClick) canvas.on('mouse:up', value.onClick);\r\n\r\n      if (value.cursor === null) {\r\n        canvas.defaultCursor = 'auto';\r\n        canvas.hoverCursor = 'auto';\r\n      } else {\r\n        canvas.defaultCursor = value.cursor;\r\n        canvas.hoverCursor = canvas.defaultCursor;\r\n      }\r\n\r\n      if (value.type === 'pencil') {\r\n        canvas.isDrawingMode = true;\r\n      } else {\r\n        canvas.isDrawingMode = false;\r\n      }\r\n    }\r\n    setSidebar(false);\r\n\r\n    _setTool(value);\r\n    toolRef.current = value;\r\n  }\r\n\r\n  const setMarker = (value: string) => {\r\n    _setMarker(value);\r\n    markerRef.current = value;\r\n  }\r\n\r\n  const changeColor = (color: ColorResult) => {\r\n    setColor(color.hex);\r\n    if (canvas) {\r\n      canvas.freeDrawingBrush.color = color.hex;\r\n    }\r\n  }\r\n\r\n  const save = () => {\r\n    if (canvas) {\r\n      const url = canvas.toDataURL({ multiplier: 3 });\r\n      startDownload(url, \"startegy.png\");\r\n    }\r\n  }\r\n\r\n  const select = () => {\r\n    setTool({...tool, type: 'select', cursor: null, onClick: null});\r\n    if (canvas) {\r\n      canvas.isDrawingMode = false;\r\n      canvas.selection = true;\r\n    }\r\n  }\r\n\r\n  const pencil = () => {\r\n    setTool({...tool, type: 'pencil', cursor: null, onClick: null});\r\n    if (canvas) {\r\n      canvas.isDrawingMode = true;\r\n    }\r\n  }\r\n\r\n  const eraser = () => {\r\n    setTool({...tool, type: 'eraser', cursor: null, onClick: null});\r\n    if (canvas) {\r\n      canvas.isDrawingMode = false;\r\n      canvas.selection = false;\r\n    }\r\n  }\r\n\r\n  const undo = () => {\r\n    if (canvas) {\r\n      canvas.undo();\r\n    }\r\n  }\r\n\r\n  const showSidebar = () => {\r\n    setSidebar(true);\r\n  }\r\n\r\n  const hideSidebar = () => {\r\n    setSidebar(false);\r\n  }\r\n\r\n  const selectMarker = (evt: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {\r\n    const target = evt.target as HTMLImageElement;\r\n    setMarker(target.src);\r\n\r\n    const cursor = `url(${target.src}), auto`;\r\n    setTool({...tool, type: 'marker', onClick: placeMarker, cursor});\r\n  }\r\n\r\n  const placeMarker = async (evt: IEvent) => {\r\n    if (markerRef && markerRef.current) {\r\n      let cachedImage = markerCache[markerRef.current];\r\n      if (!cachedImage) {\r\n        const newImage: fabric.Image = await new Promise(resolve => fabric.Image.fromURL(markerRef.current!, resolve));\r\n        markerCache[markerRef.current!] = newImage;\r\n        cachedImage = newImage;\r\n      }\r\n\r\n      const image: fabric.Image = await new Promise(resolve => cachedImage.clone(resolve));\r\n      const pointer = canvas!.getPointer(evt.e);\r\n      image.left = pointer.x;\r\n      image.top = pointer.y;\r\n\r\n      const zoom = canvas!.getZoom();\r\n      image.scale(1 / zoom);\r\n\r\n      canvas!.add(image);\r\n    }\r\n  }\r\n\r\n  // TODO consider useLayoutEffect\r\n  useEffect(() => {\r\n    if (!canvas) {\r\n      const canvas = initializeCanvas();\r\n      setCanvas(canvas);\r\n\r\n      fabric.Image.fromURL(maps[map], (image) => {\r\n        image.canvas = canvas;\r\n        image.selectable = false;\r\n        backgroundImage = image;\r\n        unerasable.add(backgroundImage.getSrc());\r\n        canvas.add(image);\r\n        canvas!.clearHistory();\r\n      });\r\n\r\n      canvas.on('mouse:down', (opt) => {\r\n        setTool({...toolRef.current, active: true});\r\n      });\r\n\r\n      canvas.on('mouse:up', (opt) => {\r\n        setTool({...toolRef.current, active: false});\r\n      });\r\n\r\n      canvas.on('mouse:move', (opt) => {\r\n        if (opt.target === null) return;\r\n        if (opt.target instanceof fabric.Image && unerasable.has(opt.target.getSrc())) return;\r\n        if (toolRef.current.type === 'eraser'\r\n            && toolRef.current.active) {\r\n          canvas.remove(opt.target!);\r\n        }\r\n      });\r\n\r\n      canvas.on('mouse:wheel', function(opt) {\r\n        const event = opt.e as WheelEvent;\r\n        const delta = event.deltaY;\r\n        let zoom = canvas.getZoom();\r\n        zoom *= 0.999 ** delta;\r\n        if (zoom > 20) zoom = 20;\r\n        if (zoom < 0.01) zoom = 0.01;\r\n        canvas.zoomToPoint({ x: event.offsetX, y: event.offsetY } as fabric.Point, zoom);\r\n        canvas.freeDrawingBrush.width = brushWidth / zoom;\r\n        opt.e.preventDefault();\r\n        opt.e.stopPropagation();\r\n      });\r\n    }\r\n\r\n    function resizeListener() {\r\n      if (containerRef.current) {\r\n        const width = containerRef.current.offsetWidth;\r\n        const height = containerRef.current.offsetHeight;\r\n        canvas?.setDimensions({ width, height });\r\n      } else {\r\n        canvas?.setDimensions(defaultSize);\r\n      }\r\n    }\r\n\r\n    resizeListener();\r\n\r\n    function undoListener({ key, ctrlKey }: KeyboardEvent) {\r\n      if(ctrlKey && key === \"z\") {\r\n        if (canvas) canvas.undo();\r\n      }\r\n    }\r\n\r\n    window.addEventListener(\"resize\", resizeListener);\r\n    document.addEventListener(\"keyup\", undoListener);\r\n    return () => {\r\n      window.removeEventListener(\"resize\", resizeListener);\r\n    }\r\n  }, [containerRef, canvas]);\r\n\r\n  return (\r\n    <div className=\"App\">\r\n      <header className=\"App-header\">\r\n        <Link className=\"App-header-title\" to=\"/\">Tarkov Debrief</Link>\r\n        <section className=\"App-header-buttons\">\r\n          <button onClick={select}><img src={selectIcon} alt=\"select\" /></button>\r\n          <button onClick={pencil}><img src={pencilIcon} alt=\"pencil\" /></button>\r\n          <button onClick={eraser}><img src={eraserIcon} alt=\"eraser\" /></button>\r\n          <button onClick={undo}><img src={undoIcon} alt=\"undo\" /></button>\r\n          <button onClick={showSidebar}><img src={addMarkerIcon} alt=\"undo\" /></button>\r\n          <button onClick={save}><img className=\"App-header-buttons-save\" src={saveIcon} alt=\"save\" /></button>\r\n        </section>\r\n      </header>\r\n      <aside className={sidebar ? \"enter\" : \"\"}>\r\n        <section onClick={hideSidebar} id=\"closeArea\"></section>\r\n        <section id=\"sidebar\">\r\n          <SidebarSection title=\"Markers\">\r\n            <button onClick={selectMarker}><img src={thickPMCMarker} alt=\"thick PMC\" /></button>\r\n            <button onClick={selectMarker}><img src={mediumPMCMarker} alt=\"medium PMC\" /></button>\r\n            <button onClick={selectMarker}><img src={lightPMCMarker} alt=\"light PMC\" /></button>\r\n            <button onClick={selectMarker}><img src={scavMarker} alt=\"light PMC\" /></button>\r\n          </SidebarSection>\r\n          <SidebarSection title=\"\">\r\n            <TwitterPicker\r\n\t\t\t  color={color}\r\n\t\t\t  triangle=\"hide\"\r\n              onChangeComplete={changeColor}></TwitterPicker>\r\n          </SidebarSection>\r\n        </section>\r\n      </aside>\r\n      <div className=\"Canvas\" ref={containerRef}>\r\n        <canvas id=\"canvas\">\r\n        </canvas>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","export default __webpack_public_path__ + \"static/media/select.87afa2df.svg\";","export default __webpack_public_path__ + \"static/media/pencil.e46769b8.svg\";","export default __webpack_public_path__ + \"static/media/eraser.fa7a8623.svg\";","export default __webpack_public_path__ + \"static/media/undo.d1789e03.svg\";","export default __webpack_public_path__ + \"static/media/marker.bde95ba7.svg\";","export default __webpack_public_path__ + \"static/media/save.701089e7.svg\";","export default __webpack_public_path__ + \"static/media/pmc-thick.9fc764b6.svg\";","export default __webpack_public_path__ + \"static/media/pmc-med.e46af3bd.svg\";","export default __webpack_public_path__ + \"static/media/pmc-light.f8f79686.svg\";","export default __webpack_public_path__ + \"static/media/scav.231f3e54.svg\";","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport MapSelector from './MapSelector';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport {\r\n  BrowserRouter as Router,\r\n  Switch,\r\n  Route,\r\n} from \"react-router-dom\";\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <Router>\r\n      <Switch>\r\n        <Route path=\"/app/:map\">\r\n          <App />\r\n        </Route>\r\n        <Route path=\"/\">\r\n          <MapSelector />\r\n        </Route>\r\n      </Switch>\r\n    </Router>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}