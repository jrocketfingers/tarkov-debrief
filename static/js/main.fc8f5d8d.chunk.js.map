{"version":3,"sources":["maps/customs.png","maps/interchange.png","maps/woods.png","maps/labs.jpg","maps/reserve.png","maps/shoreline.png","maps/factory.jpg","maps/customs-thumbnail.png","maps/interchange-thumbnail.png","maps/woods-thumbnail.png","maps/labs-thumbnail.png","maps/reserve-thumbnail.png","maps/shoreline-thumbnail.png","maps/factory-thumbnail.png","MapSelector.tsx","App.tsx","icons/select.svg","icons/pencil.svg","icons/eraser.svg","icons/undo.svg","icons/marker.svg","icons/save.svg","icons/pmc-thick.svg","icons/pmc-med.svg","icons/pmc-light.svg","icons/scav.svg","reportWebVitals.ts","index.tsx"],"names":["maps","customs","interchange","woods","labs","reserve","shoreline","factory","thumbnails","customsThumbnail","interchangeThumbnail","woodsThumbnail","labsThumbnail","reserveThumbnail","shorelineThumbnail","factoryThumbnail","MapSelector","backgroundImage","className","to","Object","entries","map","key","src","alt","defaultSize","width","height","unerasable","Set","modifierTools","markerCache","PENCIL_COLOR","SidebarSection","title","children","App","useParams","containerRef","useRef","altKeyRef","useState","type","active","onClick","onMouseMove","cursor","tool","_setTool","toolRef","prevTool","lastPosRef","x","y","color","setColor","_setMarker","markerRef","canvasRef","sidebar","setSidebar","erase","useCallback","opt","undefined","target","current","fabric","Image","has","getSrc","remove","pan","canvas","vpt","viewportTransform","e","clientX","clientY","requestRenderAll","disableDrawing","isDrawingMode","enableDrawing","setTool","value","off","on","defaultCursor","hoverCursor","selectMarker","evt","placeMarker","a","cachedImage","Promise","resolve","fromURL","newImage","clone","image","pointer","getPointer","left","top","zoom","getZoom","scale","add","useEffect","Canvas","perPixelTargetFind","selection","freeDrawingBrush","setCursor","pencilIcon","initializeCanvas","selectable","clearHistory","newTool","altKey","includes","event","delta","deltaY","zoomToPoint","offsetX","offsetY","preventDefault","stopPropagation","resizeListener","offsetWidth","offsetHeight","setDimensions","window","addEventListener","document","ctrlKey","undo","removeEventListener","selectIcon","eraserIcon","undoIcon","addMarkerIcon","url","name","link","createElement","download","href","body","appendChild","click","removeChild","startDownload","toDataURL","multiplier","saveIcon","id","thickPMCMarker","mediumPMCMarker","lightPMCMarker","scavMarker","triangle","onChangeComplete","hex","ref","onKeyDown","onKeyUp","tabIndex","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactGA","initialize","pageview","location","pathname","search","ReactDOM","render","StrictMode","basename","path","getElementById"],"mappings":"mZAAe,G,OAAA,IAA0B,qCCA1B,MAA0B,wCCA1B,MAA0B,kCCA1B,MAA0B,iCCA1B,MAA0B,oCCA1B,MAA0B,sCCA1B,MAA0B,oCCA1B,MAA0B,8CCA1B,MAA0B,kDCA1B,MAA0B,4CCA1B,MAA0B,2CCA1B,MAA0B,8CCA1B,MAA0B,gDCA1B,MAA0B,8CCqB5BA,EAA+B,CAACC,UAASC,cAAaC,QAAOC,OAAMC,UAASC,YAAWC,WACvFC,EAAqC,CAChDP,QAASQ,EACTP,YAAaQ,EACbP,MAAOQ,EACPP,KAAMQ,EACNP,QAASQ,EACTP,UAAWQ,EACXP,QAASQ,GAqBIC,ICxBXC,EDwBWD,EAlBf,WACE,OACE,sBAAKE,UAAU,cAAf,UACE,wBAAQA,UAAU,aAAlB,SACE,cAAC,IAAD,CAAMA,UAAU,mBAAmBC,GAAG,IAAtC,8BAEF,yBAASD,UAAU,UAAnB,SACGE,OAAOC,QAAQrB,GAAMsB,KAAI,mCAAEC,EAAF,iBACxB,eAAC,IAAD,CAAgBL,UAAU,eAAeC,GAAE,eAAUI,GAArD,UACE,qBAAKC,IAAKhB,EAAWe,GAAME,IAAI,QAC/B,4BAAIF,MAFKA,YExCN,MAA0B,mCCA1B,MAA0B,mCCA1B,MAA0B,mCCA1B,MAA0B,iCCA1B,MAA0B,mCCA1B,MAA0B,iCCA1B,MAA0B,sCCA1B,MAA0B,oCCA1B,MAA0B,sCCA1B,MAA0B,iC,OVyBnCG,EAAoB,CAAEC,MAAO,IAAKC,OAAQ,KAE5CC,EAAa,IAAIC,IAmBrB,IAAMC,EAAgB,CAAC,OAEjBC,EAA4C,GAC5CC,EAAuB,OAwB7B,SAASC,EAAT,GAAmE,IAAzCC,EAAwC,EAAxCA,MAAOC,EAAiC,EAAjCA,SAC/B,OAAO,sBAAKlB,UAAU,kBAAf,UACL,oBAAIA,UAAU,wBAAd,SACGiB,IAEH,qBAAKjB,UAAU,0BAAf,SACGkB,OAmUQC,MA1Tf,WAAgB,IACNf,EAAQgB,cAARhB,IACFiB,EAAeC,iBAAuB,MACtCC,EAAYD,kBAAgB,GAHrB,EAIYE,mBAAe,CACtCC,KAAM,SACNC,QAAQ,EACRC,QAAS,KACTC,YAAa,KACbC,OAAQ,OATG,mBAINC,EAJM,KAIAC,EAJA,KAWPC,EAAUV,iBAAa,CAC3BG,KAAM,SACNC,QAAQ,EACRC,QAAS,KACTC,YAAa,KACbC,OAAQ,OAGJI,EAAWX,iBAAa,CAC5BG,KAAM,SACNC,QAAQ,EACRC,QAAS,KACTC,YAAa,KACbC,OAAQ,OAGJK,EAAaZ,iBAAO,CAACa,EAAG,EAAGC,EAAG,IA3BvB,EA4BaZ,mBAAiBT,GA5B9B,mBA4BNsB,EA5BM,KA4BCC,EA5BD,OA6BUd,mBAAwB,MAAtCe,EA7BI,oBA8BPC,EAAYlB,iBAAsB,MAClCmB,EAAYnB,iBAA6B,MA/BlC,EAgCiBE,oBAAkB,GAhCnC,mBAgCNkB,EAhCM,KAgCGC,EAhCH,KAkCPC,EAAQC,uBAAY,SAACC,GACzB,QAAkBC,IAAfD,EAAIE,QAAwBhB,EAAQiB,QAAQvB,OAAQ,CACrD,GAAIoB,EAAIE,kBAAkBE,SAAOC,OAASxC,EAAWyC,IAAIN,EAAIE,OAAOK,UAAW,OAC/EZ,EAAUQ,QAASK,OAAOR,EAAIE,WAE/B,IAEGO,EAAMV,uBAAY,SAAUC,GAChC,IAAMU,EAASf,EAAUQ,QACrBQ,EAAMD,EAAQE,kBAClBD,EAAK,IAAMX,EAAIa,EAAEC,QAAU1B,EAAWe,QAAQd,EAC9CsB,EAAK,IAAMX,EAAIa,EAAEE,QAAU3B,EAAWe,QAAQb,EAC9CoB,EAAQM,mBACR5B,EAAWe,QAAU,CAAEd,EAAGW,EAAIa,EAAEC,QAASxB,EAAGU,EAAIa,EAAEE,WACjD,IAEGE,EAAiBlB,uBAAY,SAAUC,GAC9C,IAAMU,EAASf,EAAUQ,QACT,QAAZH,EAAIzC,MACNkB,EAAU0B,SAAU,EAChBO,IAA0B,IAAhB1B,EAAKJ,SACpB8B,EAAQQ,eAAgB,MAGrB,CAAClC,IAEEmC,EAAgBpB,uBAAY,SAAUC,GAC7C,IAAMU,EAASf,EAAUQ,QACT,QAAZH,EAAIzC,MACNkB,EAAU0B,SAAU,EAChBO,GAAwB,WAAd1B,EAAKL,OACpB+B,EAAQQ,eAAgB,MAGrB,CAAClC,IAOEoC,GAAUrB,uBAAY,SAACsB,GAC3B,GAAI1B,EAAUQ,QAAS,CACrB,IAAMO,EAASf,EAAUQ,QAErBjB,EAAQiB,QAAQtB,SAAS6B,EAAOY,IAAI,WAAYpC,EAAQiB,QAAQtB,SAChEK,EAAQiB,QAAQrB,aAAa4B,EAAOY,IAAI,aAAcpC,EAAQiB,QAAQrB,aAEtEuC,EAAMxC,SAAS6B,EAAOa,GAAG,WAAYF,EAAMxC,SAC3CwC,EAAMvC,aAAa4B,EAAOa,GAAG,aAAcF,EAAMvC,aAGhC,OAAjBuC,EAAMtC,QACR2B,EAAOc,cAAgB,OACvBd,EAAOe,YAAc,SAErBf,EAAOc,cAAgBH,EAAMtC,OAC7B2B,EAAOe,YAAcf,EAAOc,eAGX,WAAfH,EAAM1C,OAA2C,IAAtBF,EAAU0B,QACvCO,EAAOQ,eAAgB,EAEvBR,EAAOQ,eAAgB,EAG3BrB,GAAW,GAEXZ,EAASoC,GACTnC,EAAQiB,QAAUkB,IACjB,IAyDGK,GAAe,SAACC,GACpB,IAxDiBN,EAwDXnB,EAASyB,EAAIzB,OAxDFmB,EAyDPnB,EAAO1C,IAxDjBiC,EAAW4B,GACX3B,EAAUS,QAAUkB,EAyDpB,IAAMtC,EAAM,cAAUmB,EAAO1C,IAAjB,WACZ4D,GAAQ,2BAAIpC,GAAL,IAAWL,KAAM,SAAUE,QAAS+C,GAAa7C,aAGpD6C,GAAW,uCAAG,WAAOD,GAAP,yBAAAE,EAAA,0DACdnC,IAAaA,EAAUS,QADT,oBAEZ2B,EAAc9D,EAAY0B,EAAUS,SAFxB,gCAIuB,IAAI4B,SAAQ,SAAAC,GAAO,OAAI5B,SAAOC,MAAM4B,QAAQvC,EAAUS,QAAU6B,MAJvF,OAIRE,EAJQ,OAKdlE,EAAY0B,EAAUS,SAAY+B,EAClCJ,EAAcI,EANA,wBASkB,IAAIH,SAAQ,SAAAC,GAAO,OAAIF,EAAYK,MAAMH,MAT3D,QASVI,EATU,OAWV1B,EAASf,EAAUQ,QACnBkC,EAAU3B,EAAQ4B,WAAWX,EAAId,GACvCuB,EAAMG,KAAOF,EAAQhD,EACrB+C,EAAMI,IAAMH,EAAQ/C,EAEdmD,EAAO/B,EAAQgC,UACrBN,EAAMO,MAAM,EAAIF,GAEhB/B,EAAQkC,IAAIR,GAnBI,4CAAH,sDAsGjB,OA9EAS,qBAAU,WACR,IAAKlD,EAAUQ,QAAS,CACtB,IAAMO,EAxOZ,WACE,IAAMA,EAAS,IAAIN,SAAO0C,OAAO,SAAU,CACzClF,OAAQF,EAAYE,OACpBD,MAAOD,EAAYC,MAEnBoF,oBAAoB,EACpBC,WAAW,IAQb,OALAtC,EAAOuC,iBAAiB1D,MAAQtB,EAChCyC,EAAOuC,iBAAiBtF,MAdP,EAgBjB+C,EAAOwC,UAAP,cAAwBC,EAAxB,MAEOzC,EA0NY0C,GACfzD,EAAUQ,QAAUO,EAEpBN,SAAOC,MAAM4B,QAAQjG,EAAKsB,IAAM,SAAC8E,GAC/BA,EAAM1B,OAASA,EACf0B,EAAMiB,YAAa,EACnBpG,EAAkBmF,EAClBvE,EAAW+E,IAAI3F,EAAgBsD,UAC/BG,EAAOkC,IAAIR,GACX1B,EAAQ4C,kBAGV5C,EAAOa,GAAG,cAAc,SAACvB,GACvB,IAAMuD,EAAO,2BAAOrE,EAAQiB,SAAf,IAAwBvB,QAAQ,IACvCiC,EAAIb,EAAIa,EACVA,EAAE2C,SAAWtE,EAAQiB,QAAQvB,SAC/B2E,EAAQ5E,KAAO,MACf4E,EAAQzE,YAAc2B,EACtBC,EAAOsC,WAAY,EACnB5D,EAAWe,QAAU,CAAEd,EAAGwB,EAAEC,QAASxB,EAAGuB,EAAEE,SAC1C5B,EAASgB,QAAT,eAAuBjB,EAAQiB,UAEjCiB,GAAQmC,MAGV7C,EAAOa,GAAG,YAAY,SAACvB,GACrB,IAAIhB,EAAI,eAAOE,EAAQiB,SAInBpC,EAAc0F,SAASvE,EAAQiB,QAAQxB,QACzCK,EAAI,eAAOG,EAASgB,UAGtBiB,GAAQ,2BAAIpC,GAAL,IAAWJ,QAAQ,QAG5B8B,EAAOa,GAAG,eAAe,SAASvB,GAChC,IAAM0D,EAAQ1D,EAAIa,EACZ8C,EAAQD,EAAME,OAChBnB,EAAO/B,EAAOgC,WAClBD,GAAI,SAAI,KAASkB,IACN,KAAIlB,EAAO,IAClBA,EAAO,MAAMA,EAAO,KACxB/B,EAAOmD,YAAY,CAAExE,EAAGqE,EAAMI,QAASxE,EAAGoE,EAAMK,SAA2BtB,GAC3E/B,EAAOuC,iBAAiBtF,MAzRb,EAyRkC8E,EAC7CzC,EAAIa,EAAEmD,iBACNhE,EAAIa,EAAEoD,qBAIV,SAASC,IACP,GAAI3F,EAAa4B,QAAS,CAAC,IAAD,EAClBxC,EAAQY,EAAa4B,QAAQgE,YAC7BvG,EAASW,EAAa4B,QAAQiE,aACpC,UAAAzE,EAAUQ,eAAV,SAAmBkE,cAAc,CAAE1G,QAAOC,eACrC,CAAC,IAAD,EACL,UAAA+B,EAAUQ,eAAV,SAAmBkE,cAAc3G,IAcrC,OAVAwG,IAQAI,OAAOC,iBAAiB,SAAUL,GAClCM,SAASD,iBAAiB,SAP1B,YAAwD,IAAhChH,EAA+B,EAA/BA,IAA+B,EAA1BkH,SACL,MAARlH,GACRoC,EAAUQ,SAASR,EAAUQ,QAAQuE,UAMtC,WACLJ,OAAOK,oBAAoB,SAAUT,MAEtC,CAAC3F,EAAc6C,GAAS9D,EAAKmD,IAG9B,sBAAKvD,UAAU,MAAf,UACE,yBAAQA,UAAU,aAAlB,UACE,cAAC,IAAD,CAAMA,UAAU,mBAAmBC,GAAG,IAAtC,4BACA,0BAASD,UAAU,qBAAnB,UACE,wBAAQ2B,QAvJE,YAChBuC,GAAQ,2BAAIpC,GAAL,IAAWL,KAAM,SAAUI,OAAQ,KAAMF,QAAS,KAAMC,YAAa,QACxEa,EAAUQ,WACGR,EAAUQ,QAClB6C,WAAY,IAmJf,SAA4B,qBAAKxF,IAAKoH,EAAYnH,IAAI,aACtD,wBAAQoB,QAhJE,WAChBuC,GAAQ,2BAAIpC,GAAL,IAAWL,KAAM,SAAUI,OAAQ,KAAMF,QAAS,KAAMC,YAAa,QACxEa,EAAUQ,SA8IR,SAA4B,qBAAK3C,IAAK2F,EAAY1F,IAAI,aACtD,wBAAQoB,QA3IE,YAChBuC,GAAQ,2BAAIpC,GAAL,IAAWL,KAAM,SAAUI,OAAQ,KAAMF,QAAS,KAAMC,YAAagB,KACxEH,EAAUQ,WACGR,EAAUQ,QAClB6C,WAAY,IAuIf,SAA4B,qBAAKxF,IAAKqH,EAAYpH,IAAI,aACtD,wBAAQoB,QApIH,WACPc,EAAUQ,SACZR,EAAUQ,QAAQuE,QAkId,SAAuB,qBAAKlH,IAAKsH,EAAUrH,IAAI,WAC/C,wBAAQoB,QA/HI,WAClBgB,GAAW,IA8HL,SAA8B,qBAAKrC,IAAKuH,EAAetH,IAAI,WAC3D,wBAAQoB,QAnKH,WACPc,EAAUQ,SA1KlB,SAAuB6E,EAAaC,GAClC,IAAMC,EAAOV,SAASW,cAAc,KACpCD,EAAKE,SAAWH,EAChBC,EAAKG,KAAOL,EACZR,SAASc,KAAKC,YAAYL,GAC1BA,EAAKM,QACLhB,SAASc,KAAKG,YAAYP,GAsKtBQ,CADY/F,EAAUQ,QAAQwF,UAAU,CAAEC,WAAY,IACnC,iBAgKf,SAAuB,qBAAK1I,UAAU,0BAA0BM,IAAKqI,EAAUpI,IAAI,iBAGvF,wBAAOP,UAAW0C,EAAU,QAAU,GAAtC,UACE,yBAASf,QAhIK,WAClBgB,GAAW,IA+HwBiG,GAAG,cAClC,0BAASA,GAAG,UAAZ,UACE,eAAC5H,EAAD,CAAgBC,MAAM,UAAtB,UACE,wBAAQU,QAAS6C,GAAjB,SAA+B,qBAAKlE,IAAKuI,EAAgBtI,IAAI,gBAC7D,wBAAQoB,QAAS6C,GAAjB,SAA+B,qBAAKlE,IAAKwI,EAAiBvI,IAAI,iBAC9D,wBAAQoB,QAAS6C,GAAjB,SAA+B,qBAAKlE,IAAKyI,EAAgBxI,IAAI,gBAC7D,wBAAQoB,QAAS6C,GAAjB,SAA+B,qBAAKlE,IAAK0I,EAAYzI,IAAI,mBAE3D,cAACS,EAAD,CAAgBC,MAAM,GAAtB,SACE,cAAC,IAAD,CACPoB,MAAOA,EACP4G,SAAS,OACAC,iBA1LQ,SAAC7G,GACnBC,EAASD,EAAM8G,KACX1G,EAAUQ,UACZR,EAAUQ,QAAQ8C,iBAAiB1D,MAAQA,EAAM8G,gBA2LjD,qBACFnJ,UAAU,SACVoJ,IAAK/H,EACLgI,UAAWtF,EACXuF,QAASrF,EACTsF,SAAU,EALR,SAME,wBAAQX,GAAG,iBW7XJY,EAZS,SAACC,GACnBA,GAAeA,aAAuBC,UACxC,8BAAqBC,MAAK,YAAkD,IAA/CC,EAA8C,EAA9CA,OAAQC,EAAsC,EAAtCA,OAAQC,EAA8B,EAA9BA,OAAQC,EAAsB,EAAtBA,OAAQC,EAAc,EAAdA,QAC3DJ,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAON,GACPO,EAAQP,OCIdQ,IAAQC,WAAW,kBACnBD,IAAQE,SAAS/C,OAAOgD,SAASC,SAAWjD,OAAOgD,SAASE,QAE5DC,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,IAAD,CAAQC,SAAS,kBAAjB,SACE,eAAC,IAAD,WACE,cAAC,IAAD,CAAOC,KAAK,YAAZ,SACE,cAAC,EAAD,MAEF,cAAC,IAAD,CAAOA,KAAK,IAAZ,SACE,cAAC,EAAD,aAKRrD,SAASsD,eAAe,SAM1BpB,M","file":"static/js/main.fc8f5d8d.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/customs.e4219f37.png\";","export default __webpack_public_path__ + \"static/media/interchange.d1c1fd49.png\";","export default __webpack_public_path__ + \"static/media/woods.1db93aa7.png\";","export default __webpack_public_path__ + \"static/media/labs.bf97da17.jpg\";","export default __webpack_public_path__ + \"static/media/reserve.074ec021.png\";","export default __webpack_public_path__ + \"static/media/shoreline.23bac9da.png\";","export default __webpack_public_path__ + \"static/media/factory.87c85dcc.jpg\";","export default __webpack_public_path__ + \"static/media/customs-thumbnail.b02c6216.png\";","export default __webpack_public_path__ + \"static/media/interchange-thumbnail.20071bd5.png\";","export default __webpack_public_path__ + \"static/media/woods-thumbnail.70d05156.png\";","export default __webpack_public_path__ + \"static/media/labs-thumbnail.b903d684.png\";","export default __webpack_public_path__ + \"static/media/reserve-thumbnail.a98054b0.png\";","export default __webpack_public_path__ + \"static/media/shoreline-thumbnail.2a773a10.png\";","export default __webpack_public_path__ + \"static/media/factory-thumbnail.c6017793.png\";","import React from 'react';\nimport { Link } from 'react-router-dom';\n\nimport \"./MapSelector.css\";\n\nimport customs from \"./maps/customs.png\";\nimport interchange from \"./maps/interchange.png\";\nimport woods from \"./maps/woods.png\";\nimport labs from \"./maps/labs.jpg\";\nimport reserve from \"./maps/reserve.png\";\nimport shoreline from \"./maps/shoreline.png\";\nimport factory from \"./maps/factory.jpg\";\n\nimport customsThumbnail from \"./maps/customs-thumbnail.png\";\nimport interchangeThumbnail from \"./maps/interchange-thumbnail.png\";\nimport woodsThumbnail from \"./maps/woods-thumbnail.png\";\nimport labsThumbnail from \"./maps/labs-thumbnail.png\";\nimport reserveThumbnail from \"./maps/reserve-thumbnail.png\";\nimport shorelineThumbnail from \"./maps/shoreline-thumbnail.png\";\nimport factoryThumbnail from \"./maps/factory-thumbnail.png\";\n\nexport const maps: Record<string, string> = {customs, interchange, woods, labs, reserve, shoreline, factory};\nexport const thumbnails: Record<string, string> = {\n  customs: customsThumbnail,\n  interchange: interchangeThumbnail,\n  woods: woodsThumbnail,\n  labs: labsThumbnail,\n  reserve: reserveThumbnail,\n  shoreline: shorelineThumbnail,\n  factory: factoryThumbnail,\n};\n\nfunction MapSelector() {\n  return (\n    <div className=\"MapSelector\">\n      <header className=\"App-header\">\n        <Link className=\"App-header-title\" to=\"/\">Tarkov Debrief</Link>\n      </header>\n      <section className=\"MapList\">\n        {Object.entries(maps).map(([key, value]) => \n          <Link key={key} className=\"MapList-Card\" to={`/app/${key}`}>\n            <img src={thumbnails[key]} alt=\"key\"/>\n            <p>{key}</p>\n          </Link>\n        )}\n      </section>\n    </div>\n  )\n}\n\nexport default MapSelector;","import React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport { fabric } from \"fabric\";\nimport { ColorResult, TwitterPicker } from \"react-color\";\nimport \"fabric-history\";\nimport \"./App.css\";\nimport \"./Sidebar.css\";\n\nimport { maps } from \"./MapSelector\";\n\nimport selectIcon from \"./icons/select.svg\";\nimport pencilIcon from \"./icons/pencil.svg\";\nimport eraserIcon from \"./icons/eraser.svg\";\nimport undoIcon from \"./icons/undo.svg\";\nimport addMarkerIcon from \"./icons/marker.svg\";\nimport saveIcon from \"./icons/save.svg\";\n\nimport thickPMCMarker from \"./icons/pmc-thick.svg\";\nimport mediumPMCMarker from \"./icons/pmc-med.svg\";\nimport lightPMCMarker from \"./icons/pmc-light.svg\";\nimport scavMarker from \"./icons/scav.svg\";\nimport { IEvent } from \"fabric/fabric-impl\";\nimport { Link, useParams } from \"react-router-dom\";\n\ntype Size = { width: number; height: number };\n\nconst defaultSize: Size = { width: 300, height: 300 };\nlet backgroundImage: fabric.Image;\nlet unerasable = new Set<string>();\n\ntype Tool = {\n  active: boolean,\n  type: 'select' | 'pencil' | 'eraser' | 'marker' | 'pan',\n  onClick: null | ((evt: IEvent) => void),\n  onMouseMove: null | ((evt: IEvent) => void),\n  cursor: null | string,\n};\n\nfunction startDownload(url: string, name: string) : void {\n  const link = document.createElement('a');\n  link.download = name;\n  link.href = url;\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n}\n\nconst modifierTools = ['pan'];\nconst brushWidth = 5;\nconst markerCache: Record<string, fabric.Image> = {};\nconst PENCIL_COLOR: string = \"#f00\";\n\nfunction initializeCanvas() { \n  const canvas = new fabric.Canvas('canvas', {\n    height: defaultSize.height,\n    width: defaultSize.width,\n    //isDrawingMode: true,\n    perPixelTargetFind: true,\n    selection: false,\n  });\n\n  canvas.freeDrawingBrush.color = PENCIL_COLOR;\n  canvas.freeDrawingBrush.width = brushWidth;\n\n  canvas.setCursor(`url(${pencilIcon})`);\n\n  return canvas;\n}\n\ninterface SidebarSectionProps {\n  title: string,\n  children: React.ReactNode,\n}\n\nfunction SidebarSection({ title, children }: SidebarSectionProps) {\n  return <div className=\"sidebar-section\">\n    <h1 className=\"sidebar-section-title\">\n      {title}\n    </h1>\n    <div className=\"sidebar-section-content\">\n      {children}\n    </div>\n  </div>\n}\n\ninterface Params {\n  map: string;\n}\n\nfunction App() {\n  const { map } = useParams<Params>();\n  const containerRef = useRef<HTMLDivElement>(null);\n  const altKeyRef = useRef<boolean>(false);\n  const [tool, _setTool] = useState<Tool>({\n    type: 'pencil',\n    active: true,\n    onClick: null,\n    onMouseMove: null,\n    cursor: null,\n  });\n  const toolRef = useRef<Tool>({\n    type: 'pencil',\n    active: true,\n    onClick: null,\n    onMouseMove: null,\n    cursor: null,\n  });\n\n  const prevTool = useRef<Tool>({\n    type: 'pencil',\n    active: true,\n    onClick: null,\n    onMouseMove: null,\n    cursor: null,\n  });\n\n  const lastPosRef = useRef({x: 0, y: 0});\n  const [color, setColor] = useState<string>(PENCIL_COLOR);\n  const [, _setMarker] = useState<string | null>(null);\n  const markerRef = useRef<string | null>(null);\n  const canvasRef = useRef<fabric.Canvas | null>(null);\n  const [sidebar, setSidebar] = useState<boolean>(false);\n\n  const erase = useCallback((opt: IEvent) => {\n    if(opt.target !== undefined && toolRef.current.active) {\n      if (opt.target instanceof fabric.Image && unerasable.has(opt.target.getSrc())) return;\n      canvasRef.current!.remove(opt.target!);\n    }\n  }, []);\n\n  const pan = useCallback(function (opt) {\n    const canvas = canvasRef.current;\n    var vpt = canvas!.viewportTransform;\n    vpt![4] += opt.e.clientX - lastPosRef.current.x;\n    vpt![5] += opt.e.clientY - lastPosRef.current.y;\n    canvas!.requestRenderAll();\n    lastPosRef.current = { x: opt.e.clientX, y: opt.e.clientY };\n  }, []);\n\n  const disableDrawing = useCallback(function (opt) {\n\tconst canvas = canvasRef.current\n\tif (opt.key === 'Alt') {\n\t  altKeyRef.current = true;\n\t  if (canvas && tool.active === false) {\n\t\tcanvas!.isDrawingMode = false;\n\t  }\n    }\n  }, [tool]);\n\n  const enableDrawing = useCallback(function (opt) {\n\tconst canvas = canvasRef.current\n\tif (opt.key === 'Alt') {\n\t  altKeyRef.current = false;\n\t  if (canvas && tool.type === \"pencil\") {\n\t\tcanvas!.isDrawingMode = true;\n\t  }\n    }\n  }, [tool]);\n\n  /**\n   * Sets the current tool and resets canvas listeners.\n   * \n   * @param value: Tool\n   */\n  const setTool = useCallback((value: Tool) => {\n    if (canvasRef.current) {\n      const canvas = canvasRef.current;\n      // switch listeners (tool is old state, value is new)\n      if (toolRef.current.onClick) canvas.off('mouse:up', toolRef.current.onClick);\n      if (toolRef.current.onMouseMove) canvas.off('mouse:move', toolRef.current.onMouseMove);\n\n      if (value.onClick) canvas.on('mouse:up', value.onClick);\n      if (value.onMouseMove) canvas.on('mouse:move', value.onMouseMove);\n\n      // set the cursor according to the tool\n      if (value.cursor === null) {\n        canvas.defaultCursor = 'auto';\n        canvas.hoverCursor = 'auto';\n      } else {\n        canvas.defaultCursor = value.cursor;\n        canvas.hoverCursor = canvas.defaultCursor;\n      }\n\n      if (value.type === 'pencil' && altKeyRef.current === false) {\n        canvas.isDrawingMode = true;\n      } else {\n        canvas.isDrawingMode = false;\n      }\n    }\n    setSidebar(false);\n\n    _setTool(value);\n    toolRef.current = value;\n  }, []);\n\n  const setMarker = (value: string) => {\n    _setMarker(value);\n    markerRef.current = value;\n  }\n\n  const changeColor = (color: ColorResult) => {\n    setColor(color.hex);\n    if (canvasRef.current) {\n      canvasRef.current.freeDrawingBrush.color = color.hex;\n    }\n  }\n\n  const save = () => {\n    if (canvasRef.current) {\n      const url = canvasRef.current.toDataURL({ multiplier: 3 });\n      startDownload(url, \"startegy.png\");\n    }\n  }\n\n  const setSelect = () => {\n    setTool({...tool, type: 'select', cursor: null, onClick: null, onMouseMove: null});\n    if (canvasRef.current) {\n      const canvas = canvasRef.current;\n      canvas.selection = true;\n    }\n  }\n\n  const setPencil = () => {\n    setTool({...tool, type: 'pencil', cursor: null, onClick: null, onMouseMove: null});\n    if (canvasRef.current) {\n    }\n  }\n\n  const setEraser = () => {\n    setTool({...tool, type: 'eraser', cursor: null, onClick: null, onMouseMove: erase});\n    if (canvasRef.current) {\n      const canvas = canvasRef.current;\n      canvas.selection = false;\n    }\n  }\n\n  const undo = () => {\n    if (canvasRef.current) {\n      canvasRef.current.undo();\n    }\n  }\n\n  const showSidebar = () => {\n    setSidebar(true);\n  }\n\n  const hideSidebar = () => {\n    setSidebar(false);\n  }\n\n  const selectMarker = (evt: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {\n    const target = evt.target as HTMLImageElement;\n    setMarker(target.src);\n\n    const cursor = `url(${target.src}), auto`;\n    setTool({...tool, type: 'marker', onClick: placeMarker, cursor});\n  }\n\n  const placeMarker = async (evt: IEvent) => {\n    if (markerRef && markerRef.current) {\n      let cachedImage = markerCache[markerRef.current];\n      if (!cachedImage) {\n        const newImage: fabric.Image = await new Promise(resolve => fabric.Image.fromURL(markerRef.current!, resolve));\n        markerCache[markerRef.current!] = newImage;\n        cachedImage = newImage;\n      }\n\n      const image: fabric.Image = await new Promise(resolve => cachedImage.clone(resolve));\n\n      const canvas = canvasRef.current;\n      const pointer = canvas!.getPointer(evt.e);\n      image.left = pointer.x;\n      image.top = pointer.y;\n\n      const zoom = canvas!.getZoom();\n      image.scale(1 / zoom);\n\n      canvas!.add(image);\n    }\n  }\n\n  // TODO consider useLayoutEffect\n  useEffect(() => {\n    if (!canvasRef.current) {\n      const canvas = initializeCanvas();\n      canvasRef.current = canvas;\n\n      fabric.Image.fromURL(maps[map], (image) => {\n        image.canvas = canvas;\n        image.selectable = false;\n        backgroundImage = image;\n        unerasable.add(backgroundImage.getSrc());\n        canvas.add(image);\n        canvas!.clearHistory();\n      });\n\n      canvas.on('mouse:down', (opt: IEvent) => {\n        const newTool = {...toolRef.current, active: true};\n        const e = opt.e as MouseEvent;\n        if (e.altKey && !toolRef.current.active) {\n          newTool.type = 'pan';\n          newTool.onMouseMove = pan;\n          canvas.selection = false;\n          lastPosRef.current = { x: e.clientX, y: e.clientY };\n          prevTool.current = {...toolRef.current};\n        }\n        setTool(newTool);\n      });\n\n      canvas.on('mouse:up', (opt) => {\n        let tool = {...toolRef.current};\n\n        // Tools like Pan are under a modifier. Once you let go off the\n        // modifier they should return to the previous tool.\n        if (modifierTools.includes(toolRef.current.type)) {\n          tool = {...prevTool.current};\n        }\n\n        setTool({...tool, active: false});\n      });\n\n      canvas.on('mouse:wheel', function(opt) {\n        const event = opt.e as WheelEvent;\n        const delta = event.deltaY;\n        let zoom = canvas.getZoom();\n        zoom *= 0.999 ** delta;\n        if (zoom > 20) zoom = 20;\n        if (zoom < 0.01) zoom = 0.01;\n        canvas.zoomToPoint({ x: event.offsetX, y: event.offsetY } as fabric.Point, zoom);\n        canvas.freeDrawingBrush.width = brushWidth / zoom;\n        opt.e.preventDefault();\n        opt.e.stopPropagation();\n      });\n    }\n\n    function resizeListener() {\n      if (containerRef.current) {\n        const width = containerRef.current.offsetWidth;\n        const height = containerRef.current.offsetHeight;\n        canvasRef.current?.setDimensions({ width, height });\n      } else {\n        canvasRef.current?.setDimensions(defaultSize);\n      }\n    }\n\n    resizeListener();\n\n    function undoListener({ key, ctrlKey }: KeyboardEvent) {\n      if(ctrlKey && key === \"z\") {\n        if (canvasRef.current) canvasRef.current.undo();\n      }\n    }\n\n    window.addEventListener(\"resize\", resizeListener);\n    document.addEventListener(\"keyup\", undoListener);\n    return () => {\n      window.removeEventListener(\"resize\", resizeListener);\n    }\n  }, [containerRef, setTool, map, pan]);\n\n  return (\n    <div className=\"App\">\n      <header className=\"App-header\">\n        <Link className=\"App-header-title\" to=\"/\">Tarkov Debrief</Link>\n        <section className=\"App-header-buttons\">\n          <button onClick={setSelect}><img src={selectIcon} alt=\"select\" /></button>\n          <button onClick={setPencil}><img src={pencilIcon} alt=\"pencil\" /></button>\n          <button onClick={setEraser}><img src={eraserIcon} alt=\"eraser\" /></button>\n          <button onClick={undo}><img src={undoIcon} alt=\"undo\" /></button>\n          <button onClick={showSidebar}><img src={addMarkerIcon} alt=\"undo\" /></button>\n          <button onClick={save}><img className=\"App-header-buttons-save\" src={saveIcon} alt=\"save\" /></button>\n        </section>\n      </header>\n      <aside className={sidebar ? \"enter\" : \"\"}>\n        <section onClick={hideSidebar} id=\"closeArea\"></section>\n        <section id=\"sidebar\">\n          <SidebarSection title=\"Markers\">\n            <button onClick={selectMarker}><img src={thickPMCMarker} alt=\"thick PMC\" /></button>\n            <button onClick={selectMarker}><img src={mediumPMCMarker} alt=\"medium PMC\" /></button>\n            <button onClick={selectMarker}><img src={lightPMCMarker} alt=\"light PMC\" /></button>\n            <button onClick={selectMarker}><img src={scavMarker} alt=\"light PMC\" /></button>\n          </SidebarSection>\n          <SidebarSection title=\"\">\n            <TwitterPicker\n\t\t\t  color={color}\n\t\t\t  triangle=\"hide\"\n              onChangeComplete={changeColor}></TwitterPicker>\n          </SidebarSection>\n        </section>\n      </aside>\n      <div\n\t\t  className=\"Canvas\"\n\t\t  ref={containerRef}\n\t\t  onKeyDown={disableDrawing}\n\t\t  onKeyUp={enableDrawing} \n\t\t  tabIndex={0}>\n        <canvas id=\"canvas\">\n        </canvas>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","export default __webpack_public_path__ + \"static/media/select.a36d8019.svg\";","export default __webpack_public_path__ + \"static/media/pencil.6f256236.svg\";","export default __webpack_public_path__ + \"static/media/eraser.fa7a8623.svg\";","export default __webpack_public_path__ + \"static/media/undo.ccba6760.svg\";","export default __webpack_public_path__ + \"static/media/marker.79266f62.svg\";","export default __webpack_public_path__ + \"static/media/save.d3fc937a.svg\";","export default __webpack_public_path__ + \"static/media/pmc-thick.e9f45228.svg\";","export default __webpack_public_path__ + \"static/media/pmc-med.c746c927.svg\";","export default __webpack_public_path__ + \"static/media/pmc-light.62ae8236.svg\";","export default __webpack_public_path__ + \"static/media/scav.638c46be.svg\";","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport ReactGA from 'react-ga';\nimport './index.css';\nimport App from './App';\nimport MapSelector from './MapSelector';\nimport reportWebVitals from './reportWebVitals';\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n} from \"react-router-dom\";\n\nReactGA.initialize('UA-189112106-1');\nReactGA.pageview(window.location.pathname + window.location.search);\n\nReactDOM.render(\n  <React.StrictMode>\n    <Router basename=\"/tarkov-debrief\">\n      <Switch>\n        <Route path=\"/app/:map\">\n          <App />\n        </Route>\n        <Route path=\"/\">\n          <MapSelector />\n        </Route>\n      </Switch>\n    </Router>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}